VERSION 5.00
Object = "{CDE57A40-8B86-11D0-B3C6-00A0C90AEA82}#1.0#0"; "MSDatGrd.ocx"
Object = "{42E1C06F-7F50-11D5-A66A-000103E13086}#4.0#0"; "CaixaDeTexto.ocx"
Object = "{8F53E67C-B289-11D5-A66A-000103E13086}#4.1#0"; "Combo.ocx"
Begin VB.Form frmGestoresPagtoFrete 
   BorderStyle     =   1  'Fixed Single
   Caption         =   "Gestores de Pagamento de Frete"
   ClientHeight    =   6030
   ClientLeft      =   45
   ClientTop       =   330
   ClientWidth     =   8730
   HelpContextID   =   1000
   KeyPreview      =   -1  'True
   LinkTopic       =   "Form1"
   MaxButton       =   0   'False
   MinButton       =   0   'False
   ScaleHeight     =   6030
   ScaleWidth      =   8730
   StartUpPosition =   2  'CenterScreen
   Begin VB.PictureBox picButtons 
      Align           =   2  'Align Bottom
      Height          =   660
      HelpContextID   =   2
      Left            =   0
      ScaleHeight     =   600
      ScaleWidth      =   8670
      TabIndex        =   14
      Top             =   5370
      Width           =   8730
      Begin VB.CommandButton cmdFirst 
         Height          =   420
         Left            =   6840
         Picture         =   "frmGestoresPagtoFrete.frx":0000
         Style           =   1  'Graphical
         TabIndex        =   7
         ToolTipText     =   "Primeiro Registro"
         Top             =   120
         UseMaskColor    =   -1  'True
         Width           =   420
      End
      Begin VB.CommandButton cmdPrevious 
         Height          =   420
         Left            =   7260
         Picture         =   "frmGestoresPagtoFrete.frx":0542
         Style           =   1  'Graphical
         TabIndex        =   8
         ToolTipText     =   "Registro Anterior"
         Top             =   120
         UseMaskColor    =   -1  'True
         Width           =   420
      End
      Begin VB.CommandButton cmdNext 
         Height          =   420
         Left            =   7680
         Picture         =   "frmGestoresPagtoFrete.frx":0A84
         Style           =   1  'Graphical
         TabIndex        =   9
         ToolTipText     =   "Próximo Registro"
         Top             =   120
         UseMaskColor    =   -1  'True
         Width           =   420
      End
      Begin VB.CommandButton cmdLast 
         Height          =   420
         Left            =   8100
         Picture         =   "frmGestoresPagtoFrete.frx":0FC6
         Style           =   1  'Graphical
         TabIndex        =   10
         ToolTipText     =   "Último Registro"
         Top             =   120
         UseMaskColor    =   -1  'True
         Width           =   420
      End
      Begin VB.CommandButton cmdBuscar 
         Caption         =   "&Buscar"
         Height          =   420
         Left            =   4920
         TabIndex        =   5
         Top             =   120
         Width           =   840
      End
      Begin VB.CommandButton cmdAlterar 
         Caption         =   "&Alterar"
         Height          =   420
         Left            =   1080
         TabIndex        =   1
         Top             =   120
         Width           =   840
      End
      Begin VB.CommandButton cmdInserir 
         Caption         =   "&Inserir"
         Height          =   420
         Left            =   120
         TabIndex        =   0
         Top             =   120
         Width           =   840
      End
      Begin VB.CommandButton cmdCancelar 
         Caption         =   "Ca&ncelar"
         Height          =   420
         Left            =   3960
         TabIndex        =   4
         Top             =   120
         Width           =   840
      End
      Begin VB.CommandButton cmdConfirmar 
         Caption         =   "&Confirmar"
         Height          =   420
         Left            =   3000
         TabIndex        =   3
         Top             =   120
         Width           =   840
      End
      Begin VB.CommandButton cmdExcluir 
         Caption         =   "&Excluir"
         Height          =   420
         Left            =   2040
         TabIndex        =   2
         Top             =   120
         Width           =   840
      End
      Begin VB.CommandButton cmdListagem 
         Caption         =   "&Listagem"
         Height          =   420
         Left            =   5880
         TabIndex        =   6
         Top             =   120
         Width           =   840
      End
   End
   Begin VB.PictureBox picDados 
      BorderStyle     =   0  'None
      Enabled         =   0   'False
      Height          =   5055
      Left            =   0
      ScaleHeight     =   5055
      ScaleWidth      =   9015
      TabIndex        =   25
      TabStop         =   0   'False
      Top             =   0
      Width           =   9015
      Begin VB.CheckBox chkIdSelecionaNaOrdem 
         Caption         =   "Usa no Embarque"
         Height          =   375
         Left            =   6000
         TabIndex        =   20
         Top             =   690
         Visible         =   0   'False
         Width           =   1695
      End
      Begin CaixaDeTexto.TextBoxP txtTarifaTransf 
         Height          =   315
         Left            =   1920
         TabIndex        =   23
         Top             =   1800
         Width           =   1935
         _ExtentX        =   3413
         _ExtentY        =   556
         Tipo            =   3
         CasasDecimais   =   2
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Alignment       =   1
      End
      Begin MSDataGridLib.DataGrid grdDados 
         Height          =   2415
         Left            =   120
         TabIndex        =   13
         Top             =   2400
         Width           =   7455
         _ExtentX        =   13150
         _ExtentY        =   4260
         _Version        =   393216
         AllowUpdate     =   0   'False
         AllowArrows     =   -1  'True
         Enabled         =   -1  'True
         HeadLines       =   1
         RowHeight       =   15
         FormatLocked    =   -1  'True
         BeginProperty HeadFont {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ColumnCount     =   5
         BeginProperty Column00 
            DataField       =   "CodAdmFrete"
            Caption         =   "Código"
            BeginProperty DataFormat {6D835690-900B-11D0-9484-00A0C91110ED} 
               Type            =   0
               Format          =   ""
               HaveTrueFalseNull=   0
               FirstDayOfWeek  =   0
               FirstWeekOfYear =   0
               LCID            =   1046
               SubFormatType   =   0
            EndProperty
         EndProperty
         BeginProperty Column01 
            DataField       =   "Descricao"
            Caption         =   "Descrição"
            BeginProperty DataFormat {6D835690-900B-11D0-9484-00A0C91110ED} 
               Type            =   0
               Format          =   ""
               HaveTrueFalseNull=   0
               FirstDayOfWeek  =   0
               FirstWeekOfYear =   0
               LCID            =   1046
               SubFormatType   =   0
            EndProperty
         EndProperty
         BeginProperty Column02 
            DataField       =   "tarifasaque"
            Caption         =   "Tarifa Saque"
            BeginProperty DataFormat {6D835690-900B-11D0-9484-00A0C91110ED} 
               Type            =   1
               Format          =   "#.##0,00"
               HaveTrueFalseNull=   0
               FirstDayOfWeek  =   0
               FirstWeekOfYear =   0
               LCID            =   1046
               SubFormatType   =   1
            EndProperty
         EndProperty
         BeginProperty Column03 
            DataField       =   "tarifatransferencia"
            Caption         =   "Tarifa Transferência"
            BeginProperty DataFormat {6D835690-900B-11D0-9484-00A0C91110ED} 
               Type            =   0
               Format          =   ""
               HaveTrueFalseNull=   0
               FirstDayOfWeek  =   0
               FirstWeekOfYear =   0
               LCID            =   1046
               SubFormatType   =   0
            EndProperty
         EndProperty
         BeginProperty Column04 
            DataField       =   "IdSelecionaNaOrdem"
            Caption         =   "Usa no Embarque"
            BeginProperty DataFormat {6D835690-900B-11D0-9484-00A0C91110ED} 
               Type            =   0
               Format          =   "#.##0,00"
               HaveTrueFalseNull=   0
               FirstDayOfWeek  =   0
               FirstWeekOfYear =   0
               LCID            =   1046
               SubFormatType   =   0
            EndProperty
         EndProperty
         SplitCount      =   1
         BeginProperty Split0 
            MarqueeStyle    =   4
            AllowRowSizing  =   0   'False
            AllowSizing     =   0   'False
            BeginProperty Column00 
               ColumnAllowSizing=   0   'False
               ColumnWidth     =   599,811
            EndProperty
            BeginProperty Column01 
               ColumnAllowSizing=   0   'False
               ColumnWidth     =   1814,74
            EndProperty
            BeginProperty Column02 
               ColumnAllowSizing=   0   'False
               ColumnWidth     =   1094,74
            EndProperty
            BeginProperty Column03 
            EndProperty
            BeginProperty Column04 
            EndProperty
         EndProperty
      End
      Begin CaixaDeTexto.TextBoxP txtCodigo 
         Height          =   315
         Left            =   1920
         TabIndex        =   18
         TabStop         =   0   'False
         Top             =   180
         Width           =   375
         _ExtentX        =   661
         _ExtentY        =   556
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         MaxLength       =   2
         Locked          =   -1  'True
         Obrigatorio     =   -1  'True
      End
      Begin CaixaDeTexto.TextBoxP txtDescricao 
         Height          =   315
         Left            =   1920
         TabIndex        =   19
         Top             =   720
         Width           =   3615
         _ExtentX        =   6376
         _ExtentY        =   556
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         MaxLength       =   40
         Obrigatorio     =   -1  'True
      End
      Begin CaixaDeTexto.TextBoxP txtTarifaSaque 
         Height          =   315
         Left            =   1920
         TabIndex        =   21
         Top             =   1260
         Width           =   1935
         _ExtentX        =   3413
         _ExtentY        =   556
         Tipo            =   3
         CasasDecimais   =   2
         Formato         =   10000000000
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Alignment       =   1
      End
      Begin Combo.ComboP cboDispValePedagio 
         Height          =   315
         Left            =   6000
         TabIndex        =   22
         Top             =   1260
         Visible         =   0   'False
         Width           =   2415
         _ExtentX        =   4260
         _ExtentY        =   556
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Text            =   ""
      End
      Begin CaixaDeTexto.TextBoxP txtValorPedagio 
         Height          =   315
         Left            =   6000
         TabIndex        =   24
         Top             =   1800
         Visible         =   0   'False
         Width           =   1935
         _ExtentX        =   3413
         _ExtentY        =   556
         Tipo            =   3
         CasasDecimais   =   2
         BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
            Name            =   "MS Sans Serif"
            Size            =   8.25
            Charset         =   0
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Alignment       =   1
      End
      Begin VB.Label lblLabels 
         AutoSize        =   -1  'True
         Caption         =   "Valor Cartão Pedágio"
         Height          =   195
         Index           =   5
         Left            =   4080
         TabIndex        =   27
         Top             =   1860
         Width           =   1500
      End
      Begin VB.Label lblLabels 
         AutoSize        =   -1  'True
         Caption         =   "Dispositivo Vale Pedágio"
         Height          =   195
         Index           =   4
         Left            =   4080
         TabIndex        =   26
         Top             =   1320
         Width           =   1755
      End
      Begin VB.Label lblLabels 
         AutoSize        =   -1  'True
         Caption         =   "Tarifa Transferência"
         Height          =   195
         Index           =   3
         Left            =   120
         TabIndex        =   16
         Top             =   1800
         Width           =   1425
      End
      Begin VB.Label lblLabels 
         AutoSize        =   -1  'True
         Caption         =   "Tarifa Saque"
         Height          =   195
         Index           =   0
         Left            =   120
         TabIndex        =   15
         Top             =   1260
         Width           =   1035
      End
      Begin VB.Label lblLabels 
         AutoSize        =   -1  'True
         Caption         =   "Código"
         Height          =   195
         Index           =   1
         Left            =   120
         TabIndex        =   12
         Top             =   180
         Width           =   495
      End
      Begin VB.Label lblLabels 
         AutoSize        =   -1  'True
         Caption         =   "Descrição"
         Height          =   195
         Index           =   2
         Left            =   120
         TabIndex        =   11
         Top             =   720
         Width           =   720
      End
   End
   Begin CaixaDeTexto.TextBoxP TextBoxP1 
      Height          =   315
      Left            =   2640
      TabIndex        =   17
      Top             =   1920
      Width           =   1335
      _ExtentX        =   2355
      _ExtentY        =   556
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "MS Sans Serif"
         Size            =   8.25
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      MaxLength       =   40
      Obrigatorio     =   -1  'True
   End
End
Attribute VB_Name = "frmGestoresPagtoFrete"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit

Public Codigo_F4 As Double    'Caso de estar buscando um registro através do F4.

Dim rsDados As Recordset
Dim Status As String

'¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨ Permissões de Acesso ¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨
Dim Inclusao, Alteracao, Exclusao, Consulta, Imprimir, Especial As Boolean
Dim SemPermissao As Boolean
'¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨¨


Private Sub Form_Load()
    IconeEmpresa Me

    '# ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! #
    '21/05/10 (c/ Marta): quando efetua o código "objForm.Name" (do frmConBuscaF4) está executando o evento Form_Load do form armazenado nessa variável.
    ' Isso faz com que, caso o usuário logado não tenha permissão de acesso ao form, apareça a pergunta se deseja cadastrar o acesso ou não. Nesse caso
    'não pode aparecer essa pergunta, e sim aparecer o form padrão da busca F4. O código abaixo é necessário para não ocorrer o erro "object was unload".
    If frmPrincipal.FormIsShown = "frmConBuscaF4" Then
        SemPermissao = True
        Exit Sub
    End If
    '# ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! # ! #

    Screen.MousePointer = vbDefault
VerificaPermissoes:
    SemPermissao = True
    Verifica_PermissoesAcesso frmPrincipal.CodUsuario, Me.Name, Inclusao, Alteracao, Exclusao, Consulta, Imprimir, Especial
    If (Not Inclusao) And (Not Alteracao) And (Not Exclusao) And (Not Consulta) And (Not Imprimir) And (Not Especial) Then
        If MsgBox("Usuário não possui permissão de acesso a este programa." & vbCrLf & "Habilita as permissões?", vbYesNo + vbQuestion, "Acesso") = vbYes Then
            If Habilita_PermissoesAcesso(frmPrincipal.CodUsuario, Me.Name, Inclusao, Alteracao, Exclusao, Consulta, Imprimir, Especial) Then
                MsgBox "Permissão de acesso efetuada!", vbExclamation, "Atenção"
                GoTo VerificaPermissoes
            Else
                Unload Me
            End If
        Else
            Unload Me
        End If
    Else
        Status = ""
        SemPermissao = False
        Grava_RegistroAcessoProgramas frmPrincipal.CodUsuario, Me.Name
        
        Set rsDados = New Recordset
        rsDados.Open "SELECT * FROM AdmPagamentoFrete", frmPrincipal.db, adOpenDynamic, adLockOptimistic
        Set grdDados.DataSource = rsDados
        If Codigo_F4 <> 0 Then rsDados.Find "(CodAdmFrete = " & CStr(Codigo_F4) & ")"
        
        MostraBotao True
        
        '02/06/21 victor f
        If UCase(frmPrincipal.NomeBanco) = UCase("LONTANO") Then Preenche_ComboBox
        '--------------------
        MostraCampos
        'Obs.: Colocar a função MostraBotao antes da função MostraCampos, SEMPRE!!!
    End If
End Sub

Private Sub Preenche_ComboBox()
'02/06/21 victor f
    Dim rsTipoPedagio As New Recordset
    rsTipoPedagio.Open "SELECT Codigo, Descricao FROM ComboBox_Financeiro WHERE (NomeComboBox = 'cboTipoDispValePedagio') ORDER BY Codigo", frmPrincipal.db, adOpenForwardOnly, adLockReadOnly
    If Not rsTipoPedagio.EOF Then
        Do While Not rsTipoPedagio.EOF
            cboDispValePedagio.AddItem rsTipoPedagio!Descricao
            rsTipoPedagio.MoveNext
        Loop
    End If
    rsTipoPedagio.Close: Set rsTipoPedagio = Nothing
End Sub

Private Sub Form_KeyDown(KeyCode As Integer, Shift As Integer)
    If (KeyCode = vbKeyEscape) And (Status = "I" Or Status = "A") Then
        If MsgBox("Cancela a digitação dos dados?", vbYesNo + vbQuestion + vbDefaultButton2, "Cancelar") = vbYes Then
            cmdCancelar_Click
            Exit Sub
        End If
    End If
    If (Status = "I") Or (Status = "A") Then Exit Sub
    Select Case KeyCode
        Case vbKeyEscape
            Unload Me
        Case vbKeyHome
            cmdFirst_Click
        Case vbKeyPageUp
            cmdPrevious_Click
        Case vbKeyPageDown
            cmdNext_Click
        Case vbKeyEnd
            cmdLast_Click
        Case (vbKeyF4 And Shift = 0)
            cmdBuscar_Click
        Case vbKeyF8        'Chamar o programa "frmOcorrenciasProgramas" para cadastrar um Registro de Pendência.
            frmOcorrenciasProgramas.Origem = "TeclaF8"
            frmOcorrenciasProgramas.CodProgramaF8 = Me.Name
            frmOcorrenciasProgramas.Show vbModal
            frmOcorrenciasProgramas.Origem = ""
            frmOcorrenciasProgramas.CodProgramaF8 = ""
        Case vbKeyF9
            AcessosPorPrograma Me.Name
            Verifica_PermissoesAcesso frmPrincipal.CodUsuario, Me.Name, Inclusao, Alteracao, Exclusao, Consulta, Imprimir, Especial
        Case (vbKeyF12) And (Shift = 2)
            If Not rsDados.BOF Then
                If IsNull(rsDados!DataAlteracao) Then
                    MostraLog CStr(rsDados!CodUsuarioCriacao), rsDados!CodFilialCriacao, CStr(rsDados!DataCriacao), "", "", "", "AdmPagamentoFrete", -1
                Else
                    MostraLog CStr(rsDados!CodUsuarioCriacao), rsDados!CodFilialCriacao, CStr(rsDados!DataCriacao), CStr(rsDados!CodUsuarioAlteracao), rsDados!CodFilialAlteracao, CStr(rsDados!DataAlteracao), "AdmPagamentoFrete", -1
                End If
            End If
    End Select
End Sub

Private Sub Form_Unload(Cancel As Integer)
    If (Status = "I") Or (Status = "A") Then
        If MsgBox("Cancela a digitação dos dados?", vbYesNo + vbQuestion + vbDefaultButton2, "Cancelar") = vbYes Then
            cmdCancelar_Click
        Else
            Cancel = 1
            Exit Sub
        End If
    End If
    If Not SemPermissao Then
        Grava_RegSaidaProgramas frmPrincipal.CodUsuario, Me.Name
        
        'Foi chamado pelo form de busca.
        If rsDados.State = adStateOpen Then
            If Codigo_F4 <> 0 Then frmConBuscaF4.CodBusca = rsDados!CodAdmFrete
        End If
        
        If rsDados.State = adStateOpen Then rsDados.Close
        Set rsDados = Nothing
    End If
    
    '28/05/10 (c/ Marta): código necessário devido a implantação da nova consulta F4.
    If (frmPrincipal.FormIsShown <> "cmdCadastro") And (frmPrincipal.FormIsShown <> "frmConBuscaF4") Then
        Codigo_F4 = 0
        frmPrincipal.WshShell.SendKeys "%{T}"
    End If
End Sub

'=============================================================================================
'                                      Botões da Tela
'=============================================================================================

Private Sub cmdInserir_Click()
    If Not Inclusao Then
        MsgBox "Usuário não possui permissão para Inserir neste programa.", vbExclamation, "Atenção"
        Exit Sub
    End If
    Status = "I"
    LimpaCampos
    MostraBotao False
    txtCodigo.Text = GeraCodigo
    txtDescricao.SetFocus
End Sub

Private Sub cmdAlterar_Click()
    If Not Alteracao Then
        MsgBox "Usuário não possui permissão para Alterar neste programa.", vbExclamation, "Atenção"
        Exit Sub
    End If
    If Not rsDados.State = adStateOpen Then Exit Sub
    If Not rsDados.BOF Then
        Status = "A"
        MostraBotao False
        grdDados.Refresh
        txtDescricao.SetFocus
    End If
End Sub

Private Sub cmdExcluir_Click()
    If Not Exclusao Then
        MsgBox "Usuário não possui permissão para Excluir neste programa.", vbExclamation, "Atenção"
        Exit Sub
    End If
    On Error GoTo ExcluirErro
    If Not rsDados.State = adStateOpen Then Exit Sub
    If Not rsDados.BOF Then
        If MsgBox("Confirma a exclusão do registro?", vbYesNo + vbQuestion + vbDefaultButton2, "Exclusão") = vbYes Then
            With rsDados
                .Delete
                .MoveNext
                If .EOF Then .MoveLast
            End With
            MostraBotao True
            MostraCampos
        End If
        cmdInserir.SetFocus
    End If
    Exit Sub
ExcluirErro:
    If Err.Number = 3021 Then
        Err.Clear
        Resume Next
        Exit Sub
    End If
    TrataErro
End Sub

Private Sub cmdConfirmar_Click()
    On Error GoTo ConfirmarErro
    If Status = "" Then Exit Sub
    If Not Verifica_Obrigatorio Then Exit Sub
    
    If txtTarifaSaque.Text <> "" Then
        If CDbl(txtTarifaSaque.Text) = 0 Then
            txtTarifaSaque.SetFocus
            MsgBox "Valor inválido!", vbCritical, "Erro"
            Exit Sub
        End If
    End If
    
    If txtTarifaTransf.Text <> "" Then
        If CDbl(txtTarifaTransf.Text) = 0 Then
            txtTarifaTransf.SetFocus
            MsgBox "Valor inválido!", vbCritical, "Erro"
            Exit Sub
        End If
    End If
    
    
    If Status = "I" Then rsDados.AddNew
    If Status <> "" Then
        GravaCampos
        rsDados.Update
    End If
    Status = ""
    MostraBotao True
    MostraCampos
    cmdInserir.SetFocus
    Exit Sub
ConfirmarErro:
    TrataErro
End Sub

Private Sub cmdCancelar_Click()
    If Status = "" Then Exit Sub
    Status = ""
    MostraBotao True
    If rsDados.State = adStateOpen Then
        If Not rsDados.BOF Then rsDados.CancelUpdate
    End If
    MostraCampos
    cmdInserir.SetFocus
End Sub

Private Sub cmdBuscar_Click()
    On Error GoTo Erro
    If Not Consulta Then
        MsgBox "Usuário não possui permissão para Consultar neste programa.", vbExclamation, "Atenção"
        Exit Sub
    End If
    If txtCodigo.Text = "" Then Exit Sub
    
    Set frmConBuscaF4.objForm = New frmGestoresPagtoFrete
    frmConBuscaF4.CodBusca = -1
    frmConBuscaF4.RegAtual = txtCodigo.Text
    frmPrincipal.NomeForm = Me.Name
    frmConBuscaF4.Show vbModal
    If frmConBuscaF4.CodBusca <> -1 Then
        rsDados.MoveFirst
        rsDados.Find ("CodAdmFrete = " & CStr(frmConBuscaF4.CodBusca))
        If rsDados.EOF Then
            rsDados.Requery
            rsDados.MoveFirst
            rsDados.Find ("CodAdmFrete = " & CStr(frmConBuscaF4.CodBusca))
        End If
        MostraCampos
    End If
    Screen.MousePointer = vbDefault
    cmdInserir.SetFocus
    Exit Sub
Erro:
    TrataErro
End Sub

Private Sub cmdListagem_Click()
    'Laércio disse que não precisa implementar a listagem.
    MsgBox "Função não Disponível!", vbExclamation, "Atenção"
    cmdInserir.SetFocus
End Sub

Private Sub cmdFirst_Click()
    On Error GoTo Error
    If Not rsDados.State = adStateOpen Then Exit Sub
    If (rsDados.BOF) Or (rsDados.EOF) Then Exit Sub
    rsDados.MoveFirst
    MostraCampos
    Exit Sub
Error:
    MostraErro Err, Me.Caption
End Sub

Private Sub cmdPrevious_Click()
    On Error GoTo Error
    If Not rsDados.State = adStateOpen Then Exit Sub
    If (rsDados.BOF) Or (rsDados.EOF) Then Exit Sub
    If Not rsDados.BOF Then rsDados.MovePrevious
    If rsDados.BOF Then rsDados.MoveFirst
    MostraCampos
    Exit Sub
Error:
    MostraErro Err, Me.Caption
End Sub

Private Sub cmdNext_Click()
    On Error GoTo Error
    If Not rsDados.State = adStateOpen Then Exit Sub
    If (rsDados.BOF) Or (rsDados.EOF) Then Exit Sub
    If Not rsDados.EOF Then rsDados.MoveNext
    If rsDados.EOF Then rsDados.MoveLast
    MostraCampos
    Exit Sub
Error:
    MostraErro Err, Me.Caption
End Sub

Private Sub cmdLast_Click()
    On Error GoTo Error
    If Not rsDados.State = adStateOpen Then Exit Sub
    If (rsDados.BOF) Or (rsDados.EOF) Then Exit Sub
    rsDados.MoveLast
    MostraCampos
    Exit Sub
Error:
    MostraErro Err, Me.Caption
End Sub





'=============================================================================================
'                                     Campos da Tela
'=============================================================================================

Private Sub txtDescricao_LostFocus()
    If Status = "" Then Exit Sub
    If Status = "I" Then
        If NumReg("AdmPagamentoFrete WHERE (Descricao LIKE '" & txtDescricao.Text & "')") > 0 Then
            txtDescricao.SetFocus
            MsgBox "Informação já cadastrada!", vbCritical, "Erro"
        End If
    Else
        If UCase(rsDados!Descricao) <> UCase(txtDescricao.Text) Then
            If NumReg("AdmPagamentoFrete WHERE (Descricao = '" & txtDescricao.Text & "')") > 0 Then
                txtDescricao.SetFocus
                MsgBox "Informação já cadastrada!", vbCritical, "Erro"
            End If
        End If
    End If
End Sub

Private Sub txtTarifaSaque_LostFocus()
    If Status = "" Then Exit Sub
    If Status = "I" Then
        txtTarifaSaque.Text = Format(txtTarifaSaque.Text, "#,##0.00")
        If txtTarifaSaque.Text <> "" Then
            If CDbl(txtTarifaSaque.Text) = 0 Then
                txtTarifaSaque.SetFocus
                MsgBox "Valor inválido!", vbCritical, "Erro"
                Exit Sub
            End If
        End If
    ElseIf Status = "A" Then
        txtTarifaSaque.Text = Format(txtTarifaSaque.Text, "#,##0.00")
        If txtTarifaSaque.Text <> "" Then
            If CDbl(txtTarifaSaque.Text) = 0 Then
                txtTarifaSaque.SetFocus
                MsgBox "Valor inválido!", vbCritical, "Erro"
                Exit Sub
            End If
        End If
    End If
End Sub

Private Sub txtTarifaTransf_LostFocus()
    If Status = "" Then Exit Sub
    If Status = "I" Then
        txtTarifaTransf.Text = Format(txtTarifaTransf.Text, "#,##0.00")
        If txtTarifaTransf.Text <> "" Then
            If CDbl(txtTarifaTransf.Text) = 0 Then
                txtTarifaTransf.SetFocus
                MsgBox "Valor inválido!", vbCritical, "Erro"
                Exit Sub
            End If
        End If
    ElseIf Status = "A" Then
        txtTarifaTransf.Text = Format(txtTarifaTransf.Text, "#,##0.00")
        If txtTarifaTransf.Text <> "" Then
            If CDbl(txtTarifaTransf.Text) = 0 Then
                txtTarifaTransf.SetFocus
                MsgBox "Valor inválido!", vbCritical, "Erro"
                Exit Sub
            End If
        End If
    End If
End Sub
Private Sub cboDispValePedagio_LostFocus()
'    If cboDispValePedagio.Text = "Cartão Magnético" Then
'        txtValorPedagio.Enabled = True
'    Else
'        txtValorPedagio.Text = Empty
'        txtValorPedagio.Enabled = False
'    End If
End Sub

'=============================================================================================
'                                  Procedimentos Gerais
'=============================================================================================

Private Sub MostraCampos()
    LimpaCampos
    If Not rsDados.BOF Then
        txtCodigo.Text = rsDados!CodAdmFrete
        txtDescricao.Text = rsDados!Descricao
        txtTarifaSaque.Text = Format(rsDados!TarifaSaque, "#,##0.00")
        txtTarifaTransf.Text = Format(rsDados!TarifaTransferencia, "#,##0.00")
        
        '04/12/2020 victor f - acrescentado checkbox IdSelecionaNaOrdem
        If UCase(frmPrincipal.NomeBanco) = UCase("LONTANO") Then
            chkIdSelecionaNaOrdem.Visible = True
            If rsDados!IdSelecionaNaOrdem = "S" Then chkIdSelecionaNaOrdem.Value = 1 Else chkIdSelecionaNaOrdem.Value = 0
            '02/06/21 victor f
            cboDispValePedagio.Visible = True
            txtValorPedagio.Visible = True
            lblLabels(4).Visible = True
            lblLabels(5).Visible = True
            If Not IsNull(rsDados!TipoDispositivoValePedagio) Then cboDispValePedagio.ListIndex = rsDados!TipoDispositivoValePedagio
            txtValorPedagio.Text = Format(rsDados!ValorCartaoPedagio, "#,##0.00")
            '-----
        Else
            chkIdSelecionaNaOrdem.Visible = False
            '02/06/21 victor f
            cboDispValePedagio.Visible = False
            txtValorPedagio.Visible = False
            lblLabels(4).Visible = False
            lblLabels(5).Visible = False
            '-------------------------------
        End If
    End If
End Sub

Private Sub GravaCampos()
    If Status = "I" Then
        rsDados!CodAdmFrete = CDbl(txtCodigo.Text)
        
        rsDados!CodUsuarioCriacao = CDbl(frmPrincipal.CodUsuario)
        rsDados!CodFilialCriacao = frmPrincipal.CodFilial
        rsDados!DataCriacao = CDate(DataHora)
        
        '04/12/2020 victor f - acrescentado checkbox IdSelecionaNaOrdem
        If UCase(frmPrincipal.NomeBanco) = UCase("LONTANO") Then
            If chkIdSelecionaNaOrdem.Value = 1 Then rsDados!IdSelecionaNaOrdem = "S" Else rsDados!IdSelecionaNaOrdem = "N"
        End If
    ElseIf Status = "A" Then
        rsDados!CodUsuarioAlteracao = CDbl(frmPrincipal.CodUsuario)
        rsDados!CodFilialAlteracao = frmPrincipal.CodFilial
        rsDados!DataAlteracao = CDate(DataHora)
        
        '04/12/2020 victor f - acrescentado checkbox IdSelecionaNaOrdem
        If UCase(frmPrincipal.NomeBanco) = UCase("LONTANO") Then
            If chkIdSelecionaNaOrdem.Value = 1 Then rsDados!IdSelecionaNaOrdem = "S" Else rsDados!IdSelecionaNaOrdem = "N"
        End If
    End If

    rsDados!Descricao = txtDescricao.Text
    If txtTarifaSaque.Text = "" Then
        rsDados!TarifaSaque = Null
    Else
        rsDados!TarifaSaque = CDec(txtTarifaSaque.Text)
    End If
    If txtTarifaTransf.Text = "" Then
        rsDados!TarifaTransferencia = Null
    Else
        rsDados!TarifaTransferencia = CDec(txtTarifaTransf.Text)
    End If
    
    '02/06/21 victor f
    If UCase(frmPrincipal.NomeBanco) = UCase("LONTANO") Then
        Dim dTipoDispPed As Double: dTipoDispPed = -1
        Dim sNumCartaoPed As String: sNumCartaoPed = ""

        If cboDispValePedagio.Text <> "" Then
            rsDados!TipoDispositivoValePedagio = cboDispValePedagio.ListIndex
            dTipoDispPed = rsDados!TipoDispositivoValePedagio
        Else
            rsDados!TipoDispositivoValePedagio = Null
        End If
        
        If txtValorPedagio.Text = "" Then
            rsDados!ValorCartaoPedagio = Null
        Else
            rsDados!ValorCartaoPedagio = CDbl(txtValorPedagio.Text)
        End If
        
'        If cboDispValePedagio.Text = "Cartão Magnético" Then
'            If txtValorPedagio.Text = "" Then
'                rsDados!ValorCartaoPedagio = Null
'            Else
'                rsDados!ValorCartaoPedagio = txtValorPedagio.Text
'            End If
'        Else
'            rsDados!ValorCartaoPedagio = Null
'        End If
        
        
    End If
    '----------------------------------------------------------------------
End Sub

Private Sub MostraBotao(bVal As Boolean)
    cmdInserir.Enabled = bVal
    cmdAlterar.Enabled = bVal
    cmdExcluir.Enabled = bVal
    If (Status = "I") Or (Status = "A") Then
        cmdConfirmar.Enabled = Not bVal
        cmdCancelar.Enabled = Not bVal
    Else
        cmdConfirmar.Enabled = bVal
        cmdCancelar.Enabled = bVal
    End If
    cmdBuscar.Enabled = bVal
    cmdFirst.Enabled = bVal
    cmdPrevious.Enabled = bVal
    cmdNext.Enabled = bVal
    cmdLast.Enabled = bVal
    cmdListagem.Enabled = bVal
    picDados.Enabled = Not bVal
End Sub

Private Sub LimpaCampos()
    Dim myControl As Control
    Dim Mask As String
    For Each myControl In Controls
        If TypeOf myControl Is TextBox Then myControl.Text = ""
        If TypeOf myControl Is TextBoxP Then myControl.Text = ""
        If TypeOf myControl Is ComboBox Then myControl.ListIndex = -1
        If TypeOf myControl Is ComboP Then myControl.ListIndex = -1
        If TypeOf myControl Is DataCombo Then myControl.Text = ""
        If TypeOf myControl Is OptionButton Then myControl.Value = False
        If TypeOf myControl Is CheckBox Then myControl.Value = 0
        If TypeOf myControl Is DataP Then myControl.Text = ""
        If TypeOf myControl Is CNPJCPF Then myControl.Text = ""
        If TypeOf myControl Is HoraP Then myControl.Text = ""
        If TypeOf myControl Is MaskEdBox Then
            Mask = myControl.Mask
            myControl.Mask = ""
            myControl.Text = ""
            myControl.Mask = Mask
        End If
    Next
End Sub

Private Function GeraCodigo() As Double
    GeraCodigo = 1
    Dim rsMaximo As New Recordset
    rsMaximo.Open "SELECT MAX(CodAdmFrete) + 1 AS Maior FROM AdmPagamentoFrete", frmPrincipal.db, adOpenForwardOnly, adLockReadOnly
    If Not rsMaximo.BOF Then
        If Not IsNull(rsMaximo!Maior) Then GeraCodigo = rsMaximo!Maior
    End If
    rsMaximo.Close: Set rsMaximo = Nothing
End Function

Private Function BuscaCodigo(CodAdmFrete As Double) As Boolean
    BuscaCodigo = False
    If NumReg("AdmPagamentoFrete WHERE (CodAdmFrete = " & CodAdmFrete & ")") > 0 Then BuscaCodigo = True
End Function

Private Sub TrataErro()
    rsDados.CancelUpdate
    Select Case Err.Number
        Case -2147217864
            If BuscaCodigo(txtCodigo.Text) Then
                MsgBox "Informação alterada por outro usuário.", vbExclamation, "Atenção"
            Else
                MsgBox "Informação excluída por outro usuário.", vbCritical, "Erro"
            End If
            Status = ""
            MostraBotao True
            MostraCampos
        Case Else
            MostraErro Err, Me.Caption
    End Select
End Sub

Private Function Verifica_Obrigatorio() As Boolean
    Verifica_Obrigatorio = True
    If txtDescricao.Text = "" Then
        txtDescricao.SetFocus
        Verifica_Obrigatorio = False
    End If
    '02/06/21 victor f -
    If UCase(frmPrincipal.NomeBanco) = UCase("LONTANO") Then
'        If cboDispValePedagio.Text = "Cartão Magnético" Then
'            If txtValorPedagio.Text = "" Then
'                txtValorPedagio.SetFocus
'                Verifica_Obrigatorio = False
'            End If
'        End If
    End If
    '--------------------------------
    If Not Verifica_Obrigatorio Then
        MsgBox "Campo de preenchimento obrigatório.", vbExclamation, "Atenção"
    End If
End Function


